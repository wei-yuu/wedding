import{d as p,r as d,b as I,H as y,x as v,o as c,c as m,f as _,w as C,t as V,h as L,I as E,T as A,_ as T,E as F,C as B,F as w,g as k,j as b,N as P,a as h,k as G,v as j,n as q,O as N,u as D,z as M,P as O,A as x}from"./index-db43e76c.js";import{g as R}from"./get-file-list.api-d4285dbc.js";import{u as S}from"./use-api-call-6df89e53.js";import{g as H}from"./get.api-f86483c1.js";const J={class:"overflow-hidden"},Y={key:0,class:"font-yozai text-white text-4xl text-nowrap message inline-block"},Q=p({__name:"index",props:{bullet:{}},emits:["hide"],setup(o){const t=o,e=d(!1),n=I(()=>e.value?t.bullet.message.length>60?45e3:t.bullet.message.length>40?Math.floor(Math.random()*5+30)*1e3:t.bullet.message.length>20?Math.floor(Math.random()*10+15)*1e3:Math.floor(Math.random()*5+10)*1e3:0);return y(()=>t.bullet,()=>e.value=!0),v(()=>{e.value=!0}),(r,s)=>(c(),m("div",J,[_(A,{enterActiveClass:"transition-all ease-linear",enterFromClass:"translate-x-[100vw]",enterToClass:"translate-x-[-100%]",onAfterEnter:s[0]||(s[0]=a=>e.value=!1),onBeforeLeave:s[1]||(s[1]=a=>r.$emit("hide")),style:E({"transition-duration":`${n.value}ms`})},{default:C(()=>[e.value?(c(),m("p",Y,V(r.bullet.message),1)):L("",!0)]),_:1},8,["style"])]))}});const W=T(Q,[["__scopeId","data-v-5f43da28"]]),X={class:"grid gap-4 h-full items-center"},Z=p({__name:"screen",props:F({quantity:{}},{magazine:{default:[]},magazineModifiers:{}}),emits:["update:magazine"],setup(o){const t=B(o,"magazine"),e=o,n=d([]),r=s=>{const a=t.value.shift();a&&n.value.splice(s,1,a)};return v(()=>{n.value=t.value.splice(0,e.quantity)}),(s,a)=>{const i=W;return c(),m("div",X,[(c(!0),m(w,null,k(n.value,(l,u)=>(c(),b(i,{key:u,bullet:l,onHide:f=>r(u)},null,8,["bullet","onHide"]))),128))])}}}),K={class:"h-full w-full p-10 flex justify-center items-center"},U={class:"relative w-full h-full flex justify-center items-center"},ee=["src","alt"],te=p({__name:"background",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(o){const t=B(o,"modelValue"),e=d(),n=d(),r=d(),s=a=>{var l,u;const i=(l=t.value)==null?void 0:l.shift();i&&((u=r.value)==null||u.splice(a,1,i))};return v(async()=>{var a;r.value=(a=t.value)==null?void 0:a.splice(0,2),n.value=setInterval(async()=>{e.value?e.value=0:e.value=1},3e4),e.value=1}),P(()=>{clearInterval(n.value)}),(a,i)=>(c(),m("div",K,[h("div",U,[(c(!0),m(w,null,k(r.value,(l,u)=>(c(),b(A,{key:u,mode:"out-in",enterActiveClass:"transition-opacity ease duration-2000",leaveActiveClass:"transition-opacity ease duration-2000",enterFromClass:"opacity-0",leaveToClass:"opacity-0",onAfterLeave:f=>s(u)},{default:C(()=>[G(h("img",{class:"absolute max-h-full max-w-full rounded-md shadow-lg",src:`https://drive.google.com/thumbnail?id=${l==null?void 0:l.id}&sz=w1366`,alt:l==null?void 0:l.name},null,8,ee),[[j,e.value===u]])]),_:2},1032,["onAfterLeave"]))),128))])]))}}),se=p({__name:"player",props:{id:{},visible:{type:Boolean},host:{}},setup(o){const t=o,e=d(),n=()=>{var s,a;(s=e.value)==null||s.setShuffle(!0),(a=e.value)==null||a.playVideoAt(0)},r=()=>{e.value=new YT.Player("player",{videoId:t.id,playerVars:{autoplay:0,controls:0,enablejsapi:1,loop:1,list:/^PL/.test(t.id)?t.id:void 0},events:{onReady:n},host:t.host})};return v(()=>{r()}),(s,a)=>(c(),b(N,{to:"body"},[h("div",{id:"player",class:q({hidden:!s.visible,visible:s.visible})},null,2)]))}}),ae=()=>S(async()=>await R("1O20EMGMomt5mokbWGJbxQy6LnViXWxcs")),ne=()=>S(async()=>await H({sheetId:"1J4nMChqEgfE6XgD4C-AgTsyBGGFGkrTSrrZp0q7Ppbw",range:"Messages!A2:B"})),$=o=>{const t=[...o];for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t},le=D("message",()=>{const o=ne(),t=ae(),e=d([]),n=d([]),r=async()=>{const i=await o.fetch();i.value&&$(i.value).forEach(u=>{const[f,g]=u;e.value.push({name:f,message:g})})},s=async()=>{const i=await t.fetch();if(i.value){const l=$(i.value);n.value.push(...l.map(u=>({id:u.id,name:u.name})))}};return{messages:e,backgrounds:n,init:async()=>{M.start("正在尋找祝福~");try{await r(),await s()}catch(l){throw new Error(String(l))}finally{M.stop()}return await O.alert({title:"祝福已就定位！",options:{button:{text:"讓我們開始吧～ε٩(๑> ₃ <)۶з"}}})},getShuffleMessage:r,getShuffleBackground:s}}),oe={class:"relative h-screen w-screen"},re={class:"absolute top-0 h-full w-full"},me=p({__name:"index",setup(o){const{backgrounds:t,messages:e,getShuffleMessage:n,getShuffleBackground:r,init:s}=le(),a=d(!1),i=d(7);return y(()=>e,()=>{e.length<i.value+1&&n()},{deep:!0}),y(()=>t,()=>{t.length||r()},{deep:!0}),v(async()=>{a.value=await s()}),(l,u)=>{const f=se,g=te,z=Z;return c(),m("div",oe,[a.value?(c(),m(w,{key:0},[_(f,{id:"PLEROZ9PIiEwFLgV6pmglKtdJDM472YTjO"}),_(g,{"model-value":x(t)},null,8,["model-value"]),h("div",re,[_(z,{quantity:i.value,magazine:x(e)},null,8,["quantity","magazine"])])],64)):L("",!0)])}}});export{me as default};
